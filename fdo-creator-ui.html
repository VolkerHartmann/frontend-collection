<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Typed PID Maker UI</title>
    <script type="text/javascript" src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@kit-data-manager/metadata-editor@0.9.3/deps/opt/popper/popper.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@kit-data-manager/metadata-editor/deps/underscore/underscore-umd-min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.29.1/moment.min.js"
            integrity="sha512-qTXRIMyZIFb8iQcfjXWCO8+M5Tbc38Qi5WzdPOYZHIlZpzBHG3L3by84BBBOiRGiEb7KKtAOAs5qYdUiZiQNNQ=="
            crossorigin="anonymous" referrerpolicy="no-referrer"></script>


    <script src="js/semantic-ui/modal.min.js">
        <script src="js/ajv/ajv.min.js"></script>
    <link rel="stylesheet" href="./css/semantic.min.css">
    <link rel="stylesheet"
          href="https://cdn.jsdelivr.net/npm/@kit-data-manager/metadata-editor@0.9.3/deps/opt/fontawesome/css/all.min.css">
    <link rel="stylesheet"
          href="https://cdn.jsdelivr.net/npm/@kit-data-manager/metadata-editor@0.9.3/deps/opt/bootstrap/css/bootstrap.min.css">
    <link rel="stylesheet"
          href="https://cdn.jsdelivr.net/npm/@kit-data-manager/metadata-editor@0.9.3/deps/opt/tabulator/tabulator_bootstrap4.min.css">
    <script src="./js/apply-config.js"></script>

    <script src="./js/editor/dependencies/jsonform/jsonform.js"></script>
    <script src="./js/editor/lib/js/metadataeditor.js"></script>
    <script src="./definitions/fdo-maker/hkip.js"></script>
    <script src="./definitions/fdo-maker/recordUIDefinitionCreate.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/d3@7.6.1/dist/d3.min.js"></script>
    <link rel="stylesheet" href="./css/styles.css"/>
    <!--script src="https://cdn.jsdelivr.net/npm/@kit-data-manager/webcomponent_typed-pid-maker_pid-list@latest/dist/typid-known-pids-table.umd.js"></script-->

</head>
<body class="ui">

<h1 class="ui block header">
    <img id="app-logo" src="./images/typed-pid-maker-logo.svg" class="ui image">
    <div id="app-title" class="content">
        {app-title}
        <div id="app-subtitle" class="sub header">{app-subtitle}</div>
    </div>
    <div id="login_button" class="ui animated right floated button" tabindex="0">
        <div id="login_button_text" class="visible content">Login</div>
        <div class="hidden content">
            <i id="login_icon" class="sign-in icon"></i>
        </div>
    </div>
</h1>

<div class="ui container">
    <div id="service-url-input" class="sixteen wide column">
        <div class="two wide column">
            <div class="ui label">
                Typed PID Maker URL
            </div>
        </div>

        <div class="fourteen wide column">
            <div class="ui fluid icon input">
                <input id="endpoint" type="text" placeholder="http://localhost:8090/" value="http://localhost:8090/">
                <button class="ui vertical animated button" tabindex="0" onclick="setUrl()">
                    <div class="hidden content">Reload</div>
                    <div class="visible content">
                        <i class="fa-solid fa-arrows-rotate"></i>
                    </div>
                </button>
                <script>
                    function setUrl() {
                        let url = document.getElementById("endpoint").value;
                        document.getElementById("known-pids").setAttribute("base-url", url);
                    }
                </script>
            </div>
        </div>
    </div>

    <div class="ui segment">
        <form id="record-form"></form>
    </div>
    <div class="ui segment">
        <svg id="tree" style="width: 640px;height: 400px" />
    </div>

    <script type="module">

        import {ajaxBaseUrl, keycloak, tags, showServiceUrl, appDescription} from './js/fdo-maker.settings.js';

        import {known_types} from './definitions/fdo-maker/known-types.js';
        import {transformUserInput} from './js/typed-pid-maker-utils.js';
        import {chart} from './js/graph.js';
        applyConfig(ajaxBaseUrl, keycloak, tags, showServiceUrl, appDescription)

        loadForm();
         chart();
        function loadForm() {
            //set type names selection
            model['properties']['digitalObjectType'].enum = known_types.map(a => a.label);

            //create form (mapping service map go here later)
            let options = {
                operation: "CREATE",
                dataModel: model,
                uiForm: uiDefinitionCreate,
                //resource: rowColumnvalue
            };
            $('#record-form').empty();
            $('#record-form').metadataeditorForm(options, function onSubmitValid(output) {
                console.log(output);
                //transform result to PID Record and send to TPIDM
                let record = transformUserInput(output, model, known_types);
                console.log(record);
                //post to TPIDM
            });
        }
    </script>
</div>


</body>
</html>
